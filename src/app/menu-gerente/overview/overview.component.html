<!-- ============================================== -->
<!-- ESTRUTURA PRINCIPAL: TELA DE GEST√ÉO DO CARD√ÅPIO -->
<!-- ============================================== -->
<div class="tela-gerente-container">
  
  <!-- CABE√áALHO: M√âTICAS E BOT√ÉO ADICIONAR ITEM -->
  <header class="top-header">
    <div class="header-content">
      <!-- Contagem de itens no card√°pio -->
      <div class="overview-box">
        <h3 class="box-title">Items no card√°pio</h3>
        <div class="box-count">{{ menuItems.length }} <span>üìä</span></div>
      </div>
      <!-- Bot√£o para abrir o modal de adi√ß√£o -->
      <button class="btn-add" (click)="openAddItemModal()">
        + Adicionar Item
      </button>
    </div>
  </header>

  <!-- CORPO PRINCIPAL: FILTROS E TABELA -->
  <div class="content-body">
    <h2 class="section-title">Itens Adicionados</h2>

    <!-- BARRA DE FILTROS E PESQUISA -->
    <div class="filter-bar">
      <!-- Campo de busca por nome -->
      <input
        type="text"
        placeholder="üîç Busque pelo Item"
        [(ngModel)]="searchTerm"
        (input)="applyCombinedFilter()"
        class="search-input">
      
      <!-- Bot√µes de filtro por categoria (Loop) -->
      <button
        *ngFor="let category of allCategories"
        class="filter-btn-categoria"
        (click)="applyCategoryFilter(category)"
        [class.active]="selectedCategory === category">
        {{ category }}
      </button>
    </div>

    <!-- TABELA DE ITENS -->
    <table class="menu-table">
      <thead>
        <tr>
          <th>Foto</th>
          <th>Nome</th>
          <th>Pre√ßo</th>
          <th>Categoria</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        <!-- Loop: Renderiza itens filtrados -->
        <tr *ngFor="let item of filteredItems">
          <!-- Dados do item: Foto, Nome, Pre√ßo, Categoria -->
          <td><img [src]="item.foto || 'placeholder.jpg'" alt="{{ item.nome }}" class="item-foto"></td>
          <td>{{ item.nome }} <span class="item-tag">{{ item.tag }}</span></td>
          <td>{{ item.preco }}</td>
          <td>
            <span
              class="category-pill"
              [ngClass]="'category-' + item.categoria">
              {{ item.categoria }}
            </span>
          </td>
          <!-- A√ß√µes: √çcones de Editar e Remover -->
          <td class="action-icons popup-parent">
            <span class="icon-edit" (click)="openEditItem(item)">‚úèÔ∏è</span>
            <span class="icon-remove" (click)="openRemoveConfirm(item)">üóëÔ∏è</span>

            <!-- Popup de Confirma√ß√£o de Remo√ß√£o (aparece na linha do item selecionado) -->
            <app-remove-popup
              *ngIf="isRemovePopupOpen && selectedItem === item"
              [itemName]="selectedItem.nome"
              (close)="closeModal()"
              (confirmRemove)="onRemoveConfirmed()">
            </app-remove-popup>
          </td>
        </tr>
      </tbody>
    </table>
    
    <!-- Rodap√© da tabela: Contagem de itens -->
    <div class="items-footer">
      Exibindo {{ filteredItems.length }} de {{ menuItems.length }} Itens
    </div>
  </div>
</div>

<!-- ============================================== -->
<!-- MODAIS E OVERLAYS (FORA DA ESTRUTURA PRINCIPAL) -->
<!-- O overlay captura o clique fora do modal para fechar -->
<!-- ============================================== -->

<!-- 1. Modal para Adicionar Item -->
<div class="modal-overlay"
  *ngIf="isAddItemModalOpen"
  (click)="closeModal()">
  <app-add-item-modal
    (close)="closeModal()"
    (itemAdded)="onItemAdded($event)"
    (click)="$event.stopPropagation()"
    [ngClass]="isAddItemModalOpen ? 'side-panel-enter' : 'side-panel-exit'">
  </app-add-item-modal>
</div>

<!-- 2. Modal para Editar Item -->
<div class="modal-overlay"
  *ngIf="isEditItemModalOpen && selectedItem"
  (click)="closeModal()">
  <app-edit-item-modal
    [item]="selectedItem"
    (close)="closeModal()"
    (itemUpdated)="onItemUpdated($event)"
    (click)="$event.stopPropagation()"
    [ngClass]="isEditItemModalOpen ? 'side-panel-enter' : 'side-panel-exit'">
  </app-edit-item-modal>
</div>